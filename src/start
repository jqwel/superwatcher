#!/usr/bin/env bash
# vim: ft=sh
LOG_DIR="${SUPERWATCHER_HOME}/var/log"
if [ ! -d "${LOG_DIR}" ]; then
  mkdir -p "${LOG_DIR}"
fi

RUNNING=`forever list | grep  "${LOG_DIR}"`

if [ -z "${RUNNING}" ]; then
  forever start --append -l "${LOG_DIR}/forever.log" -o "${LOG_DIR}/out.log" \
    -e "${LOG_DIR}/err.log" -c bash "${SUPERWATCHER_HOME}/main"
fi
#set up a watchdog script
crontab -l | grep -v "${SUPERWATCHER_HOME}" | crontab
crontab -l > crontemp
printf "* * * * *\texport SUPERWATCHER_HOME=\"${SUPERWATCHER_HOME}\"; \"${SUPERWATCHER_HOME}/watchdog\" > /dev/null 2>&1\n" >> crontemp
cat crontemp | crontab
rm crontemp
